<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>AdminLTE 3 | DataTables</title>

	<!-- Google Font: Source Sans Pro -->
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="../../plugins/fontawesome-free/css/all.min.css">
	<!-- DataTables -->
	<link rel="stylesheet" href="../../plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
	<link rel="stylesheet" href="../../plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
	<link rel="stylesheet" href="../../plugins/datatables-buttons/css/buttons.bootstrap4.min.css">
	<!-- Theme style -->
	<link rel="stylesheet" href="../../dist/css/adminlte.min.css">
	<!-- daterange picker -->
	<link rel="stylesheet" href="../../plugins/daterangepicker/daterangepicker.css">
	<!-- Toast Grid -->
	<link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
	<!-- jQuery OrgChart CSS CDN -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/orgchart/5.0.0/css/jquery.orgchart.min.css" integrity="sha512-9A2BSSUL5eXVMWwrB8aDX8GeOOSMMVCk3fvqOplnswmo4IN4s6DW2ywpb3VCDcGCVwDc3g6S1k9T72NsCkgw5A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<!-- jsTree CSS -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.12/themes/default/style.min.css" />

</head>
<body class="layout-top-nav">
	<div class="wrapper">

		<!-- Content Wrapper. Contains page content -->
		<div class="content-wrapper">
			<!-- 콘텐츠 헤더 (Page header) -->
			<section class="content-header">
				<div class="container-fluid">
					<div class="row mb-2">
						<div class="col-sm-6">
							<h1>Lots</h1>
						</div>
					</div>
				</div>
			</section>
			<!-- /.콘텐츠 헤더 (Page header) -->
			<!-- 메인 콘텐츠 -->
			<section class="content">
				<div class="col-2">
				</div>
				<div class="container-fluid">
					<div class="row">
						<div class="col-3">
							<div class="card">
								<div class="card-header">
									<h3>Lot Tree Test</h3>
								</div>
								<div class="card-body">
									<div id="lot_grid"></div>
								</div>
							</div>
						</div>
						<div class="col-3">
							<div class="card">
								<div class="card-header">
									<h3>Lot Tree Test</h3>
								</div>
								<div class="card-body">
									<div id="lot_tree" class="bg-white border rounded"
										style="height: calc(100vh - 300px); overflow-y: scroll;">
									</div>
								</div>
							</div>
						</div>
						<div class="col-6">
							<div class="card" id="detail_info">
								<div class="card-header">
									<h3></h3>
								</div>
								<div class="card-body">
									<!-- 원자재 -->
									<!--
									<div class="row">
										<div class="col-12">
											<h4>
												<i class="fas fa-globe"></i> 회사명
												<small class="float-right">입고일: 2/10/2014</small>
											</h4>
										</div>
									</div>
									<div class="row invoice-info">
						                <div class="col-sm-4 invoice-col">
						                  From
						                  <address>
						                    <strong>Admin, Inc.</strong><br>
						                    795 Folsom Ave, Suite 600<br>
						                    San Francisco, CA 94107<br>
						                    Phone: (804) 123-5432<br>
						                    Email: info@almasaeedstudio.com
						                  </address>
						                </div>
						                <div class="col-sm-4 invoice-col">
						                  To
						                  <address>
						                    <strong>John Doe</strong><br>
						                    795 Folsom Ave, Suite 600<br>
						                    San Francisco, CA 94107<br>
						                    Phone: (555) 539-1037<br>
						                    Email: john.doe@example.com
						                  </address>
						                </div>
						                <div class="col-sm-4 invoice-col">
						                  <b>Invoice #007612</b><br>
						                  <br>
						                  <b>Order ID:</b> 4F3S8J<br>
						                  <b>Payment Due:</b> 2/22/2014<br>
						                  <b>Account:</b> 968-34567
						                </div>
						              </div>
									  -->
									  <div class="row">
  										<div class="col-12">
  											<h4>
  												<i class="fas fa-globe"></i> 회사명
  												<small class="float-right">생산일: 2/10/2014</small>
  											</h4>
  										</div>
  									</div>
									
									  <!-- 뎁스 수정... -->
									<div id="toast_single">
											<!-- Toast Grid Ajax -->
									</div>
								</div>
							</div>
						</div>
						<!--
						<div class="col-4">
							<div class="card">
								<div class="card-header">
									<h3>Lot Tracking Node Test</h3>
								</div>
								<div class="row">
									<div class="card-body d-flex justify-content-center align-items-center">
										<div id="chart_container">
										</div>
									</div>
								</div>
							</div>
						</div>
						-->
					</div>
					<!-- /.col -->
				</div>
			<!-- /.container-fluid -->
			</section>
		<!-- /.content -->
		</div>
		<!-- /.content-wrapper -->
		</aside>
	<!-- /.control-sidebar -->
	</div>
	<!-- ./wrapper -->

	<!-- jQuery -->
	<script src="../../plugins/jquery/jquery.min.js"></script>
	<!-- jsTree JS -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.12/jstree.min.js"></script>
	<!-- Bootstrap 4 -->
	<script src="../../plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
	<!-- Select2 -->
	<script src="../../plugins/select2/js/select2.full.min.js"></script>
	<!-- AdminLTE App -->
	<script src="../../dist/js/adminlte.min.js"></script>
	<!-- AdminLTE for demo purposes -->
	<script src="../../dist/js/demo.js"></script>
	<!-- InputMask -->
	<script src="../../plugins/moment/moment.min.js"></script>
	<script src="../../plugins/inputmask/jquery.inputmask.min.js"></script>
	<!-- date-range-picker -->
	<script src="../../plugins/daterangepicker/daterangepicker.js"></script>
	<!-- Tempusdominus Bootstrap 4 -->
	<script src="../../plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js"></script>
	<!-- Toast Grid -->
	<script src="https://uicdn.toast.com/tui-grid/latest/tui-grid.min.js"></script>
	<!-- jQuery OrgChart JS CDN -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/orgchart/5.0.0/js/jquery.orgchart.min.js" integrity="sha512-IUNqrYw8R7mj0iBzb0FOTGTgEFrxZCHVCHnePUEmcjJ/XQE/0sqRhBmGpp20N2lVzAkIBs0Sz+ibRN8/W9YFnQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<!-- Page specific script -->
	<script th:inline="javascript">
		const lot_url = '/rest/lots';
		const lot_dataSource = {
			api: {
				readData: {url: lot_url, method: 'GET'},
			},
			contentType: 'application/json',
		};

		$(function () {
			lotGrid();
		});

		function lotGrid() {
			lotGrid = new tui.Grid({
				el: document.getElementById('lot_grid'),
				data: lot_dataSource,
				scrollX: true,
				scrollY: true,
				bodyHeight: 770,
				rowHeight: 60,
				columns: [
					{header: 'LOT', name: 'PRODUCTION_LOT_ID', align: 'center', width: 100},
					{header: '제품명', name: 'ITEM_NAME', align: 'left'},
				],
			});
			
			lotGrid.on('failResponse', function(ev) {
				alert(JSON.parse(ev.xhr.responseText).message);
			});
			
			lotGrid.on('click', (ev) => {
				if (ev.targetType != "cell") {
					return;
				}
				
				lotGrid.setSelectionRange({
					start: [ev.rowKey, 0],
					end: [ev.rowKey, lotGrid.getColumns().length]
				});
				
				const lotId = lotGrid.getValue(ev.rowKey, "LOT_ID");
				loadLotTree(lotId);
			});
		}
		
		
// -------------------------------------------------------------------------------------------
		//OrgTree
		function loadLotTree() {
			let jsonData = 			
				[{
                    "parent": "#",
                    "menuOrder": "1",
                    "menuDepth": "1",
                    "id": "lot1",
                    "text": "작업지시ID"
                },
                {
                    "parent": "lot1",
                    "menuOrder": "1",
                    "menuDepth": "2",
                    "id": "lot1-1",
                    "text": "PROD-20250225-0001"
                },
                {
                    "parent": "lot1",
                    "menuOrder": "2",
                    "menuDepth": "2",
                    "id": "lot1-2",
                    "text": "작업지시상세ID_2"
                },
                {
                    "parent": "lot1",
                    "menuOrder": "3",
                    "menuDepth": "2",
                    "id": "lot1-3",
                    "text": "작업지시상세ID_3"
                },
                {
                    "parent": "lot1",
                    "menuOrder": "4",
                    "menuDepth": "2",
                    "id": "lot1-4",
                    "text": "작업지시상세ID_4"
                },
                {
                    "parent": "lot1-1",
                    "menuOrder": "1",
                    "menuDepth": "3",
                    "id": "lot1-1-1",
                    "text": "반제품ID_1"
                },
                {
                    "parent": "lot1-1",
                    "menuOrder": "2",
                    "menuDepth": "3",
                    "id": "lot1-1-2",
                    "text": "반제품ID_2"
                },
                {
                    "parent": "lot1-1",
                    "menuOrder": "3",
                    "menuDepth": "3",
                    "id": "lot1-1-3",
                    "text": "반제품ID_3"
                },
                {
                    "parent": "lot1-1",
                    "menuOrder": "1",
                    "menuDepth": "4",
                    "id": "lot1-1-1",
                    "text": "원자재ID_1"
                },
                {
                    "parent": "lot1-1",
                    "menuOrder": "2",
                    "menuDepth": "5",
                    "id": "lot1-1-2",
                    "text": "원자재ID_2"
                },
                {
                    "parent": "lot1-1",
                    "menuOrder": "3",
                    "menuDepth": "6",
                    "id": "lot1-1-3",
                    "text": "원자재ID_3"
                },
                ];
				
				$('#lot_tree').jstree({
	                'core' : {
	                "animation" : 0,
	                "check_callback": true,
	                'data' : jsonData
	                }
	            });
		}		
	
		$('#lot_tree').on('select_node.jstree', function(e,data){
			console.log(data.node.id);
			let select_id = data.node.id;
			// 그리드 생성
			grid();
			
			$("#detail_info").show();
			$("#detail_info h3").text(data.node.text);
			
			
			
			
			
			
			
			
		});
// ---------------------------------------------------------------------------------
		const url = '/ajax/toastTest';
		const dataSource = {
	        api: {
	            readData: {url: url, method: 'GET'},
	        },
			contentType: 'application/json',
	    };
		
		function grid() {
			
			if(grid1) {
				grid1.destroy();
				grid1 = null;
		  }
			
			
		    grid1 = new tui.Grid({
		        el: document.getElementById('toast_single'),
		        data: dataSource,
		        scrollX: true,
		        scrollY: true,
		        rowHeaders: ['checkbox'],
		        columns: [
		            {header: 'ID', name: 'ID', align: 'center', editor: 'text'},
		            {header: 'COL_1', name: 'COL_1', align: 'center', editor: 'text'},
		            {header: 'COL_2', name: 'COL_2', align: 'center', editor: 'text'},
		            {header: 'COL_3', name: 'COL_3', align: 'center', editor: 'text'},
		        ],
		    });

		    grid1.on('failResponse', function(ev) {
		        alert(JSON.parse(ev.xhr.responseText).message);
		    });
			
			
			grid1.on('editingStart', function(ev) {
			    const {rowKey, columnName, value} = ev;
			    const rowData = grid1.getRow(rowKey);
				
				// PK 수정 불가 && 새로 추가된 행은 작성 가능
				if (columnName == 'ID' && !rowData.isNew) {
					ev.stop();
				}
			});
		}

		$("#btn_add_row").on("click", function () {
		    const newRowKey = grid1.appendRow(
		        {
		            "ID": '',
		            "COL_1": '',
		            "COL_2": '',
		            "COL_3": '',
		            isNew: true
		        },
		        {focus: true}
		    );
		});

        $("#btn_insert").on("click", function() {
			grid1.request('createData');
			grid1.reloadData();  // 실패시 테이블 리로드
			// GET 요청시 데이터 보낼려면 header 설정
		});
		
		$("#btn_update").on("click", function() {
			grid1.request('updateData');
		});
		
        $("#btn_delete").on("click", function() {
			grid1.removeCheckedRows();
			
			// 반드시 removeCheckedRows()후에 실행 순서
			// DELETE는 body가 없고 url과 header만 있음, 기본값 url -> url대신 header에 담아 보냄
			const ids = grid1.getModifiedRows().deletedRows.map(row => row.ID).join(',');
			dataSource.api.deleteData.headers['X-Delete-IDs'] = ids;
			
		    grid1.request('deleteData');
			grid1.reloadData();  // 실패시 테이블 리로드
		});	

// ---------------------------------------------------------------------------------
		/*
		// jQuery Org Chart
		$("#toast_single").on("click", function() {
			
			console.log("toast click");
			
			var data = {
		        id: '1',
		        name: 'Root Node',
		        title: 'CEO',
		        children: [
		          {
		            id: '2',
		            name: 'Child Node 1',
		            title: 'Manager',
		            children: [
		              { id: '3', name: 'Grandchild Node 1', title: 'Engineer' },
		              { id: '4', name: 'Grandchild Node 2', title: 'Engineer' }
		            ]
		          },
		          {
		            id: '5',
		            name: 'Child Node 2',
		            title: 'Manager'
		          }
		        ]
		      };
				
			  console.log(data);
		      // OrgChart 초기화
		      $('#chart_container').orgchart({
				
		        'data': data, // 데이터 입력
		        'nodeContent': 'title', // 노드에 표시할 속성
		        'pan': true, // 패닝 활성화
		        'zoom': false, // 줌 활성화
				'direction': 'b2t' // 방향 설정 (bottom to top)
		      });
		});
		*/
		
	</script>
</body>
</html>