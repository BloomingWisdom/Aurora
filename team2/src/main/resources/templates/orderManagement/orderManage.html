<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="_csrf" th:content="${_csrf.token}" />
<meta name="_csrf_header" th:content="${_csrf.headerName}" />
<title>AdminLTE 3 | DataTables</title>

<!-- Google Font: Source Sans Pro -->
<link rel="stylesheet"
	href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
<!-- Font Awesome -->
<link rel="stylesheet"
	href="../../plugins/fontawesome-free/css/all.min.css">
<!-- Theme style -->
<link rel="stylesheet" href="../../dist/css/adminlte.min.css">
<!-- custom style -->
<link rel="stylesheet" href="../../dist/css/custom.css">

<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
	crossorigin="anonymous">

<link rel="stylesheet"
	href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
<link rel="stylesheet"
	href="https://uicdn.toast.com/select-box/latest/toastui-select-box.css" />
<link rel="stylesheet"
	href="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.css" />
<link rel="stylesheet"
	href="https://uicdn.toast.com/autocomplete/latest/toastui-autocomplete.min.css">
</head>
<body class="hold-transition sidebar-mini">
	<div class="wrapper">

		<!-- 상단 메뉴 -->
		<nav th:replace="~{includes/navbar :: navbar}"></nav>
		<!-- /.상단 메뉴 -->

		<!-- 좌측 메뉴 -->
		<aside th:replace="~{includes/sidebar :: sidebar}"></aside>
		<!-- /.좌측 메뉴 -->

		<!-- Content Wrapper. Contains page content -->
		<div class="content-wrapper">
			<!-- 콘텐츠 헤더 (Page header) -->
			<nav th:replace="~{includes/pageHeader :: pageHeader}"></nav>

			<!-- 메인 콘텐츠 -->
			<section class="content contentOrder">
				<div class="container-fluid">
					<div class="row">
						<div class="col-12">
							<div class="card mx-3">
								<div class="d-flex justify-content-between px-3 py-3">
									<div class="d-flex">
										<div class="d-flex">
											<div class="custom-label">수주기간 :</div>
											<div
												class="tui-datepicker-input tui-datetime-input tui-has-focus">
												<input id="startpicker-input" type="text" aria-label="Date">
												<span class="tui-ico-date"></span>
												<div id="startpicker-container" style="margin-left: -1px;"></div>
											</div>
											<span class="mx-2">~</span>
											<div
												class="tui-datepicker-input tui-datetime-input tui-has-focus">
												<input id="endpicker-input" type="text" aria-label="Date">
												<span class="tui-ico-date"></span>
												<div id="endpicker-container" style="margin-left: -1px;"></div>
											</div>
										</div>
										<div class="d-flex ml-4">
											<div class="custom-label">거래처 :</div>
											<div id="cusInput"></div>
										</div>
										<div class="d-flex ml-4">
											<div class="custom-label">품목 :</div>
											<input type="text" class="form-control" id="itemInput">
										</div>
										<div class="d-flex ml-4">
											<div class="custom-label">수주번호 :</div>
											<input type="text" class="form-control" id="idInput">
										</div>
										<div class="d-flex align-items-center ml-4">
											<div class="custom-label">진행상태 :</div>
											<div class="form-check form-switch">
												<input class="form-check-input" type="checkbox"
													role="switch" id="statusInput">
											</div>
										</div>
									</div>
									<div class="card-tools">
										<!-- <input type="button" id="btn_add_row" class="btn btn-primary" value="행추가"> -->
										<input type="button" id="btn_search" class="btn btn-primary btn-sm" value="조회"> 
										<input type="button" id="btn_insert" class="btn btn-primary btn-sm" value="등록"> 
										<input type="button" id="btn_update" class="btn btn-primary btn-sm" value="수정"> 
										<input type="button" id="btn_delete" class="btn btn-primary btn-sm" value="삭제">
									</div>
								</div>
								
							</div>
							<div class="card-body" id="toast_single">
								<!-- Toast Grid Ajax -->
							</div>
							<!-- /.card-body -->
						</div>
						<!-- /.card -->
					</div>
					<!-- /.col -->
				</div>
				<!-- /.row -->
		</div>
		<!-- /.container-fluid -->
		</section>
		<!-- /.content -->
	</div>
	<!-- /.content-wrapper -->
	<!-- 좌측 메뉴 -->
	<footer th:replace="~{includes/footer :: footer}"></footer>
	<!-- /.좌측 메뉴 -->
	<!-- Control Sidebar -->
	<aside class="control-sidebar control-sidebar-dark">
		<!-- Control sidebar content goes here -->
	</aside>
	<!-- /.control-sidebar -->
	</div>
	<!-- ./wrapper -->

	<!-- jQuery -->
	<script src="../../plugins/jquery/jquery.min.js"></script>
	<!-- Bootstrap 4 -->
	<script src="../../plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
	<!-- AdminLTE App -->
	<script src="../../dist/js/adminlte.min.js"></script>

	<script src="https://uicdn.toast.com/tui-grid/latest/tui-grid.min.js"></script>
	<script
		src="https://uicdn.toast.com/select-box/latest/toastui-select-box.js"></script>
	<script
		src="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.js"></script>
	<script
		src="https://uicdn.toast.com/autocomplete/latest/toastui-autocomplete.min.js"></script>

	<!-- Page specific script -->
	<script th:inline="javascript">
    
    var grid1;
    
    const url = '/ajax/order';
    const dataSource = {
        api: {
            readData: { url: url, method: 'GET' },
        },
        contentType: 'application/json',
    };

    document.addEventListener("DOMContentLoaded", function () {
        grid();
        console.log("dataSource", dataSource);
    });

    function grid() {
        grid1 = new tui.Grid({
            el: document.getElementById('toast_single'),
            data: dataSource,
            scrollX: true,
            scrollY: true,
            rowHeaders: ['checkbox'],
            columnOptions: {
            	resizable: true,
            },
            columns: [
                { header: '수주번호', name: 'ORDER_ID', align: 'center', editor: 'text' },
                { header: '진행상태', name: 'ORDER_STATUS', align: 'center', editor: 'text',
                	renderer: {
                    styles: {
                        fontWeight: 'bold',
                        color: (props) => props.value == '미결' ? '#ff6464' : '#999'
                      }} },
                { header: '거래처', name: 'CUSTOMER_ID', align: 'left', editor: 'text' },
                { header: '품목명', name: 'ITEM_ID', align: 'left', editor: 'text' },
                { header: '수주일자', name: 'ORDER_DATE', align: 'center', editor: 'text' },
                { header: '수주금액', name: 'ORDER_PR', align: 'right', editor: 'text', whiteSpace: 'pre-wrap', formatter: function(value){
                    if (value.value != null) {
                        // value.value가 숫자가 아니라면 숫자로 변환
                        const numericValue = Number(value.value);
                        return `${numericValue.toLocaleString('kr-KR')}원`;
                    }
                    return '';
              } },
                { header: '납품예정일', name: 'DELIVERY_DATE', align: 'center', editor: 'text' },
                { header: '단위', name: 'UNIT', align: 'center', editor: 'text' },
                { header: '규격', name: 'STANDARD', align: 'center', editor: 'text' },
                { header: '담당자', name: 'SALES_REP_ID', align: 'center', editor: 'text' },
                { header: '수주수량', name: 'ORDER_QTY', align: 'right', editor: 'text', formatter: function(value){
                    if (value.value != null) {
                        const numericValue = Number(value.value);
                        return numericValue.toLocaleString();
                    }
                    return '';
              } },
                { header: '출하수량', name: 'SHIPPED_QTY', align: 'right', editor: 'text', formatter: function(value){
                    if (value.value != null) {
                        const numericValue = Number(value.value);
                        return numericValue.toLocaleString();
                    }
                    return '';
              } },
                { header: '수주잔량', name: 'BACKLOG', align: 'right', editor: 'text', formatter: function(value){
                    if (value.value != null) {
                        const numericValue = Number(value.value);
                        return numericValue.toLocaleString();
                    }
                    return '';
              } },
                { header: '등록자', name: 'REGIST_BY', align: 'center', editor: 'text' },
                { header: '수정일자', name: 'UPDATE_DATE', align: 'center', editor: 'text' },
                { header: '등록일자', name: 'CREATE_DATE', align: 'center', editor: 'text' },
                { header: '비고', name: 'REMARKS', align: 'left', editor: 'text' }
            ],
        });

        grid1.on('failResponse', function (ev) {
            alert(JSON.parse(ev.xhr.responseText).message);
        });

        grid1.on('editingStart', function (ev) {
            const { rowKey, columnName, value } = ev;
            const rowData = grid1.getRow(rowKey);

            // PK 수정 불가 && 새로 추가된 행은 작성 가능
            if (columnName == 'ID' && !rowData.isNew) {
                ev.stop();
            }
        });
    }

    // Select Box
    const customers = document.getElementById('cusInput');
    const selectBox = new tui.SelectBox(customers, {
        data: [
                 { label: 'CUST01', value: 'CUST01', selected: true },
                 { label: 'CUST02', value: 'CUST02' }              
           
        ],
    });
    
    //dateRange
  var today = new Date();
    const DatePicker = tui.DatePicker;

    // startpicker와 endpicker의 초기 상태에서 캘린더를 숨깁니다.
    const rangePicker = DatePicker.createRangePicker({
        startpicker: {
            date: today,
            input: '#startpicker-input',
            container: '#startpicker-container',
            // 클릭하기 전에는 캘린더를 숨기도록 설정
            isVisible: false  // 초기에는 캘린더가 보이지 않게
        },
        endpicker: {
            date: today,
            input: '#endpicker-input',
            container: '#endpicker-container',
            // 클릭하기 전에는 캘린더를 숨기도록 설정
            isVisible: false  // 초기에는 캘린더가 보이지 않게
        },
        selectableRanges: [
            [today, new Date(today.getFullYear() + 1, today.getMonth(), today.getDate())]
        ],
        type: 'date',
        format: 'YYYY-MM-dd'
    });

    // startpicker 클릭 시 캘린더를 열기
    document.getElementById('startpicker-input').addEventListener('click', function () {
        rangePicker.open('start');  // startpicker가 클릭되면 시작 날짜 캘린더 열기
    });

    // endpicker 클릭 시 캘린더를 열기
    document.getElementById('endpicker-input').addEventListener('click', function () {
        rangePicker.open('end');  // endpicker가 클릭되면 끝 날짜 캘린더 열기
    });
    
</script>

</body>
</html>