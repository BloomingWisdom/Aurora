<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 오라클 MyBatis 사용시 문장 끝에 세미콜론 있으면 오류남! -->

<mapper namespace="com.itwillbs.repository.PurchaseMapper">
	
<!--	발주 리스트-->
	<select id="getPurchaseList" resultType="map">	
	SELECT PO_NUM,
		   PO_COUNT,
		   PO_PRICE,
		   TO_CHAR(CREATE_DATE, 'YYYY-MM-DD') AS CREATE_DATE,
		   (SELECT NAME FROM MEMBER M1 WHERE M1.MEMBER_ID = PO.MEMBER_ID) AS MEMBER_NAME,
		   CUSTOMER_ID,
		   PO_STATUS,
		   TO_CHAR(UPDATE_DATE, 'YYYY-MM-DD') AS UPDATE_DATE,
		   (SELECT NAME FROM MEMBER M2 WHERE M2.MEMBER_ID = PO.UPDATE_MEMBER) AS UPDATE_MEMBER
	FROM 
		PURCHASE_ORDER PO
	</select>
	
<!--	발주 등록-->
	<insert id="insertPurchase">
	INSERT INTO PURCHASE_ORDER (
<!-- 			PO_ID -->
		    CREATE_DATE
		  , MEMBER_ID
		  , CUSTOMER_ID
		  , PO_STATUS
		  , PO_NUM		
		) VALUES (
<!--         #{PO_ID},  -->
          CURRENT_DATE, 
        #{INSERT_MEM}, 
        #{CUSTOMER_ID}, 
        #{PO_STATUS}, 
        'PO' || TO_CHAR(CURRENT_DATE, 'YYYYMMDD-HH24MISS')
    )
	</insert>
	
<!--	발주 수정-->
	<update id="updatePurchase">
    UPDATE PURCHASE_ORDER
    	SET 
       	 	CREATE_DATE = CURRENT_DATE,
       	 	CUSTOMER_ID = #{CUSTOMER_ID},
       	 	UPDATE_DATE = CURRENT_DATE,
       	 	UPDATE_MEMBER = #{UPDATE_MEM},
       	 	PO_NUM = #{PO_NUM, jdbcType=VARCHAR}
    WHERE PO_NUM = #{PO_NUM, jdbcType=VARCHAR}  <!-- PO_ID를 기준으로 업데이트 -->
	</update>
	
	<!-- DELETE (데이터 삭제) -->
    <delete id="deletePurchase">
        DELETE FROM PURCHASE_ORDER 
        	WHERE PO_NUM = #{PO_NUM}
    </delete>
    
    
<!--   발주 상세 유니온 -->
   <select id="getPurchaseDetail" resultType="map">	
	SELECT
  		MATERIAL_ID,
  		MATERIAL_NM,
  		<!--  		NULL AS PO_COUNT,  -->
  		PO_PRICE,
  		<!--  		NULL AS TOTAL_PRICE,  -->  
  		CAST(NULL AS VARCHAR2(10)) AS UPDATE_DATE,  
  		CAST(NULL AS VARCHAR2(100)) AS UPDATE_MEMBER  
	FROM (
  		SELECT '1' AS MATERIAL_ID, '유리강판' AS MATERIAL_NM, '2000' AS PO_PRICE, NULL AS UPDATE_DATE, NULL AS UPDATE_MEMBER FROM DUAL
  		UNION ALL
  		SELECT '2', '철강', '3000', NULL, NULL FROM DUAL
  		UNION ALL
  		SELECT '3', '알루미늄', '4000', NULL, NULL FROM DUAL
  		UNION ALL
  		SELECT '4', '철판', '5000', NULL, NULL FROM DUAL
  		UNION ALL
  		SELECT '5', '강철발판', '6000', NULL, NULL FROM DUAL
  	)
</select>
    
    <insert id="insertDetail">
	INSERT INTO PURCHASE_ORDER (
		    MATERIAL_ID
		  , PO_COUNT
		  , PO_PRICE
		) VALUES (
        #{MATERIAL_ID}, 
        #{PO_COUNT}, 
        #{PO_PRICE} 
    )
	</insert>
    
    
    
    
</mapper>