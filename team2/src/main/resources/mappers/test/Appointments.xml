<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itwillbs.repository.AppointmentsMapper">

    <select id="getAppointList" parameterType="map" resultType="map">
	SELECT
	mh.ASSIGNMENT_TYPE AS ASSIGNMENT_TYPE,
	TO_CHAR(mh.CHANGE_DATE, 'YYYY-MM-DD') AS CHANGE_DATE,
	mh.MEMBER_ID AS MEMBER_ID,
	m.NAME AS NAME,
	mh.OLD_GRADE AS OLD_GRADE,
	mh.NEW_GRADE AS NEW_GRADE,
	mh.OLD_DEPT AS OLD_DEPT,
	mh.NEW_DEPT AS NEW_DEPT,
	mh.ETC AS ETC
	FROM MEMBER_HISTORY mh
	LEFT JOIN MEMBER m
	ON mh.member_id = m.member_id
	WHERE 1=1
	<if test="startDate != null and startDate != ''">
		AND mh.change_date <![CDATA[>=]]>
		#{startDate}
	</if>
	<if test="endDate != null and endDate != ''">
		AND mh.change_date <![CDATA[<=]]>
		#{endDate}
	</if>
	<if test="appointGubun != null and appointGubun != ''">
		AND mh.assignment_type = #{appointGubun}
	</if>
    </select>

    <select id="getMinMaxDate" resultType="map">
        SELECT 
            TO_CHAR(NVL(MIN(CHANGE_DATE), TO_DATE('2024-01-01', 'YYYY-MM-DD')), 'YYYY-MM-DD') AS minDate,
            TO_CHAR(NVL(MAX(CHANGE_DATE), SYSDATE), 'YYYY-MM-DD') AS maxDate
        FROM MEMBER_HISTORY
    </select>

</mapper>
