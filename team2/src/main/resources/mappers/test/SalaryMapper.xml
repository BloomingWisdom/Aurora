<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 오라클 MyBatis 사용시 문장 끝에 세미콜론 있으면 오류남! -->

<mapper namespace="com.itwillbs.repository.SalaryMapper">

    <select id="selectSalaryList" resultType="map">
    <!-- selectSalaryList - 급여기록 조회 -->
    <!-- getSalaryListMinMaxDate에서 조회된 최대최소일 범위의 급여기록 조회 -->
        SELECT
            S.PAYDAY,
            S.MEMBER_ID,
            M.NAME,
            S.GRADE_ID,
            M.DEPT_ID,
            M.SALARY,
            S.POSITION_BONUS,
            S.HOLIDAY_BONUS,
            S.NIGHT_BONUS,
            S.YEAREND_BONUS,
            S.FULLSERVICE_BONUS,
            S.PERFORMANCE_BONUS,
            (M.SALARY + S.POSITION_BONUS + S.HOLIDAY_BONUS + S.NIGHT_BONUS + 
             S.YEAREND_BONUS + S.FULLSERVICE_BONUS + S.PERFORMANCE_BONUS) AS TOTAL
        FROM SALARY S
        JOIN MEMBER M
          ON S.MEMBER_ID = M.MEMBER_ID
		WHERE
			1 = 1
			<if test='id != "admin"'>
			   AND
				  S.MEMBER_ID = #{id}
		  	</if>
			<if test='startDate != null and startDate != "" 
						and endDate != null and endDate != ""'>
				AND 
					PAYDAY BETWEEN #{startDate} 
					AND #{endDate} 
			</if>
		ORDER BY
			PAYDAY DESC
    </select>
    
    <select id="getSalaryListMinMaxDate" resultType="map">
     <!-- getSalaryInputMinMaxDate - 급여조회에서 최대최소일 조회 -->
        SELECT 
		      MAX(PAYDAY)	AS SALARY_MAX_DATE
    		, MIN(PAYDAY) 	AS SALARY_MIN_DATE
		FROM
		      SALARY
	    WHERE
			  1 = 1
		  <if test='id != "admin"'>
			  AND
				 member_id = #{id}
		  </if>
    </select>
    
    <select id="selectSalaryListById" resultType="map">
    <!-- 사원ID에 해당하는 급여정보를 조회 -->
		 SELECT
            S.PAYDAY,
            S.MEMBER_ID,
            M.NAME,
            S.GRADE_ID,
            M.DEPT_ID,
            M.SALARY,
            S.POSITION_BONUS,
            S.HOLIDAY_BONUS,
            S.NIGHT_BONUS,
            S.YEAREND_BONUS,
            S.FULLSERVICE_BONUS,
            S.PERFORMANCE_BONUS,
            (M.SALARY + S.POSITION_BONUS + S.HOLIDAY_BONUS + S.NIGHT_BONUS + 
             S.YEAREND_BONUS + S.FULLSERVICE_BONUS + S.PERFORMANCE_BONUS) AS TOTAL
		FROM 
			SALARY S
		JOIN MEMBER M
          ON S.MEMBER_ID = M.MEMBER_ID
		WHERE
			1 = 1
		AND
			S.MEMBER_ID = #{id}
		ORDER BY
			PAYDAY DESC
		
    </select>
    
    <!-- 사원별 급여 입력(관리자) -->
	<insert id="insertSalary" parameterType="map"> 
		INSERT ALL
	        INTO SALARY (
				<if test="PAYDAY != null"> PAYDAY </if>
			  , <if test="MEMBER_ID != null"> MEMBER_ID </if>
			  , <if test="GRADE != null"> GRADE_ID </if>
			  , <if test="POSITION_BONUS != null"> POSITION_BONUS </if>
			  , <if test="HOLIDAY_BONUS != null"> HOLIDAY_BONUS </if>
			  , <if test="NIGHT_BONUS != null"> NIGHT_BONUS </if>
			  , <if test="YEAREND_BONUS != null"> YEAREND_BONUS </if>
			  , <if test="FULLSERVICE_BONUS != null"> FULLSERVICE_BONUS </if>
			  , <if test="PERFORMANCE_BONUS != null"> PERFORMANCE_BONUS </if>
			 	 )
	        VALUES (
				<if test="PAYDAY != null"> #{daterange} </if>
			  , <if test="MEMBER_ID != null"> #{member} </if>
			  , <if test="GRADE != null"> #{grade} </if>
			  , <if test="POSITION_BONUS != null"> #{position} </if>
			  , <if test="HOLIDAY_BONUS != null"> #{holiday} </if>
			  , <if test="NIGHT_BONUS != null"> #{night} </if>
			  , <if test="YEAREND_BONUS != null"> #{yearend} </if>
			  , <if test="FULLSERVICE_BONUS != null"> #{fullservice} </if>
			  , <if test="PERFORMANCE_BONUS != null"> #{performance} </if>
				  )
	        INTO MEMBER (
				<if test="NAME != null"> NAME </if>
			  , <if test="DEPARTMENT != null"> DEPT_ID </if>
			  , <if test="SALARY != null"> SALARY </if>
				  )
	        VALUES (
				<if test="NAME != null"> #{name} </if>
		  	  , <if test="DEPARTMENT != null"> #{department} </if>
			  , <if test="SALARY != null"> #{salary_basic} </if>
			  	 )
    	SELECT * FROM dual
 	</insert> 
 	
 	<!-- 급여 수정 -->
 	<update id="updateSalary" parameterType="map">
		UPDATE SALARY 
	   	   SET 
	   	   	   POSITION_BONUS = #{positionBonus}
	       	 , HOLIDAY_BONUS = #{holidayBonus}
	       	 , NIGHT_BONUS = #{nightBonus}
	       	 , YEAREND_BONUS = #{yearendBonus}
	       	 , FULLSERVICE_BONUS = #{fullserviceBonus}
	       	 , PERFORMANCE_BONUS = #{performanceBonus}
		WHERE 
			 MEMBER_ID = #{id}
	</update>

</mapper>